<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cuenta atr√°s</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body { margin:0; font-family: system-ui; }
header { padding:16px; }
h1 { margin:0 0 6px; font-size:18px; }
.sub { opacity:.7; font-size:14px; }

.grid { display:grid; gap:12px; padding:0 16px 16px; }
.card { border:1px solid #eee; border-radius:16px; padding:12px; }
#map { height:50vh; border-radius:16px; }

.big { font-size:20px; font-weight:700; }
.muted { opacity:.7; }
progress { width:100%; height:14px; }

.reveal { display:none; margin-top:10px; padding:10px; border-radius:12px; background:#f4f4ff; }

.milestones { display:grid; gap:10px; margin-top:10px; }
.mcard { border:1px solid #eee; border-radius:12px; padding:10px; }
.locked { opacity:.4; }
</style>
</head>

<body>

<!-- üîí PANTALLA DE LOGIN -->
<div id="loginScreen" style="
position:fixed; inset:0; background:white;
display:flex; flex-direction:column;
align-items:center; justify-content:center;
z-index:9999; text-align:center; padding:20px;
">
<h2>üîí Acceso privado</h2>
<p>Introduce la clave para continuar</p>
<input type="password" id="passwordInput" placeholder="Clave..."
style="padding:10px; border-radius:8px; border:1px solid #ccc;">
<button onclick="checkPassword()"
style="margin-top:10px; padding:10px 16px; border-radius:8px; border:none; background:black; color:white;">
Entrar
</button>
<p id="errorMsg" style="color:red; display:none;">Clave incorrecta</p>
</div>

<header>
<h1>Algo se est√° preparando‚Ä¶</h1>
<div class="sub">No hagas planes el fin de semana del <b>8 de mayo de 2026</b>.</div>
</header>

<div class="grid">
<div class="card">
<div class="big" id="countdown"></div>
<div class="muted" id="progressText"></div>
<progress id="timeProgress" value="0" max="100"></progress>

<div class="reveal" id="revealBox">
<div class="big">üéâ Destino revelado</div>
<div id="revealMsg"></div>
</div>
</div>

<div class="card">
<div class="big" style="font-size:16px;">Hitos</div>
<div class="milestones" id="milestoneList"></div>
</div>

<div id="map"></div>
</div>

<script>
/* üîê CONTRASE√ëA */
const CORRECT_PASSWORD = "14022024"; // CAMBIA ESTO

function checkPassword() {
  const input = document.getElementById("passwordInput").value;
  if (input === CORRECT_PASSWORD) {
    document.getElementById("loginScreen").style.display = "none";
  } else {
    document.getElementById("errorMsg").style.display = "block";
  }
}

/* CONFIG */
const START = new Date("2026-02-14T00:00:00+01:00");
const END = new Date("2026-05-08T18:00:00+02:00");

const ORIGIN = { name:"Sant Andreu de la Barca", lat:41.4472, lng:1.97594 };
const DEST = { name:"Jaca", lat:42.5710, lng:-0.54945 };

const ROUTE = [
[41.4472,1.97594],
[41.6176,0.6200],
[41.5220,-0.3500],
[42.1401,-0.4089],
[42.2740,-0.6890],
[42.5190,-0.3660],
[42.5710,-0.54945]
];

const MILESTONES = [
{ pct:10, hint:"üëü Zapatillas c√≥modas." },
{ pct:25, hint:"üß• Algo de abrigo ligero." },
{ pct:40, hint:"üéí Mochila peque√±a." },
{ pct:60, hint:"üèîÔ∏è Huele a monta√±a." },
{ pct:80, hint:"üè∞ Sitio con historia." }
];

/* HELPERS */
function clamp(n,a,b){ return Math.max(a,Math.min(b,n)); }
function toRad(d){ return d*Math.PI/180; }
function dist(a,b){
const R=6371;
const dLat=toRad(b[0]-a[0]);
const dLng=toRad(b[1]-a[1]);
const s=Math.sin(dLat/2)**2+Math.cos(toRad(a[0]))*Math.cos(toRad(b[0]))*Math.sin(dLng/2)**2;
return 2*R*Math.asin(Math.sqrt(s));
}
function totalKm(r){ let t=0; for(let i=1;i<r.length;i++) t+=dist(r[i-1],r[i]); return t; }

function format(ms){
const s=Math.floor(ms/1000)%60;
const m=Math.floor(ms/60000)%60;
const h=Math.floor(ms/3600000)%24;
const d=Math.floor(ms/86400000);
return `${d} d√≠as ${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}

/* MAPA */
const map=L.map("map");
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
const fullLine=L.polyline(ROUTE,{opacity:.2}).addTo(map);
const drawnLine=L.polyline([ROUTE[0]],{weight:6}).addTo(map);
const car=L.marker(ROUTE[0],{
icon:L.divIcon({html:"üöó",className:"",iconSize:[20,20]})
}).addTo(map);
map.fitBounds(fullLine.getBounds());

const kmTotal=totalKm(ROUTE);

function tick(){
const now=new Date();
const t=clamp((now-START)/(END-START),0,1);
const kmDone=kmTotal*t;

const remaining=END-now;
document.getElementById("countdown").innerText=
remaining>0?`Faltan ${format(remaining)}`:"Es hoy.";

document.getElementById("timeProgress").value=Math.round(t*100);
document.getElementById("progressText").innerText=
`Progreso: ${Math.round(t*100)}%`;

if(now>=END){
document.getElementById("revealBox").style.display="block";
document.getElementById("revealMsg").innerHTML=
`Nos vamos a <b>${DEST.name}</b> üíõ`;
L.marker([DEST.lat,DEST.lng]).addTo(map);
}

const milestoneList=document.getElementById("milestoneList");
milestoneList.innerHTML="";
MILESTONES.forEach(m=>{
const div=document.createElement("div");
div.className="mcard"+(t*100>=m.pct?"":" locked");
div.innerText=t*100>=m.pct?m.hint:"üîí Bloqueado";
milestoneList.appendChild(div);
});
}

tick();
setInterval(tick,1000);
</script>
</body>
</html>
